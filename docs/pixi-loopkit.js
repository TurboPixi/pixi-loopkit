!function(e){var t={};function i(s){if(t[s])return t[s].exports;var r=t[s]={i:s,l:!1,exports:{}};return e[s].call(r.exports,r,r.exports,i),r.l=!0,r.exports}i.m=e,i.c=t,i.d=function(e,t,s){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)i.d(s,r,function(t){return e[t]}.bind(null,r));return s},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=1)}([function(e,t){e.exports=PIXI},function(e,t,i){"use strict";i.r(t),i.d(t,"LoopKit",(function(){return c})),i.d(t,"Props",(function(){return n})),i.d(t,"Loop",(function(){return a})),i.d(t,"scale",(function(){return h})),i.d(t,"hexColor",(function(){return d}));var s=i(2),r=i.n(s);function n(e){let t,i={},s={},r=[],n=[],o=e=>{n.push(e);let s=i[e](t);return n.splice(n.lastIndexOf(e),1),s},h={addWatcher:e=>{r.push(e)},removeWatcher:e=>{r.splice(r.indexOf(e),1)},loadState(e){Object.assign(t,e)},refresh(){Object.keys(i).forEach(e=>{t[e]=o(e)})},_dependencies:()=>s,derivedProps:()=>Object.fromEntries(Object.keys(i).map(e=>[e,t[e]]))};return t=new Proxy(h,{get:(e,t)=>(n.forEach(e=>{(s[t]||[]).includes(e)||(s[t]=s[t]||[],s[t].push(e))}),Reflect.has(e,t)?e[t]:Reflect.has(i,t)?(e[t]=o(t),e[t]):(e[t]=null,null)),set(e,n,h){let a=Reflect.has(e,n)||Reflect.has(i,n),l=e[n];return"function"==typeof h?(i[n]=h,a&&(h=o(n))):(Reflect.has(i,n)&&!Reflect.has(e,n)&&o(n),e[n]=h),a&&(h!==l&&((e,t,i)=>{r.forEach(s=>{s(e,t,i)})})(n,h,l),s[n]&&s[n].forEach(e=>{t[e]=o(e)})),!0}}),Object.entries(e||{}).forEach(([e,i])=>{t[e]=i}),h.refresh(),t}function o(e,t=0){return Math.round(e*Math.pow(10,t))/Math.pow(10,t)}function h(e,t,i,s,r){let n=t+(i-t)*(e=null==e?(s-t)/(i-t)||0:e),h=o(t)==t&&o(i)==i;return n=o(n,h&&!r?0:6),r&&(n-=n%r),n}class a{constructor(e=4,t=60){this._loopSeconds=e,this.fps=t,this.frameFull=0}get frames(){return this.loopSeconds*this.fps-1}get frame(){return this.frameFull/this.frames}get loopSeconds(){return this._loopSeconds}set loopSeconds(e){let t=this.frame;this._loopSeconds=e,this.frameFull=Math.floor(this.frames*t)}delay(e){return Math.abs(this.frameFull-e)%this.frames/this.frames}tick(e){let t=this.frameFull+(e||1);this.frameFull=(this.frames+t)%this.frames}}var l=i(0);class c{constructor({canvas:e,onFrame:t,antialias:i,bgColor:s,loopSeconds:r}){e="string"==typeof e?document.querySelector(e):e,this.canvas=e,this.width=0,this.height=0,this.looper=new a(r||1),this.app=new l.Application({view:e,antialias:void 0===i||i}),s&&(this.bgColor=d(s),this.bg=new l.Graphics,this.app.stage.addChild(this.bg)),this.graphics=new l.Graphics,this.app.stage.addChild(this.graphics),this.setDimensions=this.setDimensions.bind(this),this.onKeyDown=this.onKeyDown.bind(this),this._connectListeners(!0),this._renderPending=null,this.setDimensions(),this.app.ticker.add(this._onFrame.bind(this)),t?this.onFrame=t.bind(this):this.stop(),this.render()}_onFrame(e){this.onFrame&&(!1!==e&&this.looper.tick(),this.onFrame(this.graphics,this.looper.frame))}start(){this.onFrame&&this.app.ticker.start()}stop(){this.app.ticker.stop()}pause(e){(e=void 0===e?this.app.ticker.started:e)?this.stop():this.start()}render(){this.app.ticker.started||(window.cancelAnimationFrame(this._renderPending),this._renderPending=window.requestAnimationFrame(()=>{this._onFrame(!1),this.app.render()}))}addChild(e){this.graphics.addChild(e)}removeChild(e){this.graphics.removeChild(e)}setDimensions(e){let t=this.canvas.parentElement.getBoundingClientRect();[this.width,this.height]=[t.width,t.height],this.canvas.style.width=this.width,this.canvas.style.height=this.height,this.app.renderer.resize(t.width,t.height),this.bg&&(this.bg.clear(),this.bg.beginFill(this.bgColor),this.bg.drawRect(0,0,this.width,this.height),this.bg.endFill())}export(e){let t=l.RenderTexture.create({width:2*this.width,height:2*this.height});t.setResolution(2),this.app.renderer.render(this.app.stage,t);let i=this.app.renderer.plugins.extract.base64(t,"image/png",1),s=document.createElement("a");s.setAttribute("href",i),s.setAttribute("download",e||"capture.png"),s.style.display="none",document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(i)}exportLoop(){this.stop(),this.looper.frameFull=0;for(let e=0;e<=this.looper.frames;e++){this._onFrame(!1);let t=("0000"+e).slice(-4);this.export(`frame-${t}.png`),this.looper.tick()}}onKeyDown(e){" "==e.key?this.pause():"ArrowRight"==e.key?(this.looper.tick(e.shiftKey?1:e.ctrlKey?60:10),this.render()):"ArrowLeft"==e.key?(this.looper.tick(e.shiftKey?-1:e.ctrlKey?-60:-10),this.render()):"e"==e.key?(this.stop(),this.exportLoop()):"p"==e.key&&this.export()}_connectListeners(e){let t=e?window.addEventListener:window.removeEventListener;t("resize",this.setDimensions),t("keydown",this.onKeyDown)}destroy(){this._connectListeners(!1),this.app.destroy()}}const p={LoopKit:c,Props:n,Loop:a,scale:h};t.default={loopkit:p};let d=e=>r()(e).num()},function(e,t){e.exports=chroma}]);